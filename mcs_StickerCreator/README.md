# Проект mcs-StickerCreator

Проект предназначен для генерации PDF файла с наклейками и вспомогательных файлов DXF для резки PDF на плоттере.

### Входной файл

Входной файл представляет собой TXT файл. Данные в файле представлены следующим образом:
```txt
MCScap SLEEP, M; Mod: 15E-03M25; mks.ru; 245560
MCScap SLEEP, M; Mod: 15E-03M25; mks.ru; 245561
MCScap SLEEP, M; Mod: 15E-03M25; mks.ru; 245562
MCScap SLEEP, M; Mod: 15E-03M25; mks.ru; 245563
MCScap SLEEP, M; Mod: 15E-03M25; mks.ru; 245564
```
Символ ";" является переносом на следующую строку.

### Выходной файл

Выходными файлами являются файлы `output.pdf` и `output.dxf`. Они сохраняются в директорию `output` с датой начал обработки, т.е.
```txt
|-> output/
|       |-> 2024-11-13T15-29-13
|           |-> output.pdf
|           |-> output.dxf
```
Если стикеров больше чем на одну страницу, то генерируется многостраничный PDF и 2 DXF файла. 
Если последняя страница PDF файла заполнена наполовину, то сохраняется дополнительный файл DXF, т.е.
```txt
|-> output/
|       |-> 2024-11-13T15-34-04
|           |-> output.pdf
|           |-> output.dxf
|           |-> output_last_page.dxf
```

### Описание структуры проекта

```
./mcs_StickerCreator
|-> _svglib/
|-> example/
|-> input/
|-> output/
|-> template/
|        |-> dxf
|        |-> svg
|-> constants.py
|-> main.py
|-> read_data.py
|-> draw.py
|-> sticker.py
```
* `_svglib/` - копия библиотеки svglib с исправлением для правильного отображения свойства `file-rule` в SVG
* `example/` - директория c примерами входного файла и выходных;
* `input/` - директория, в которой хранятся файлы с входными данными;
* `output/` - директория, в которую сохраняются выходные файлы;
* `template/` - директория с шаблонами наклеек в формате SVG и контуров для их резки в формате DXF;
* `constants.py` - основные константы;
* `main.py` - основной скрипт создания наклеек;
* `read` - функция чтения данных из входного TXT файла;
* `sticker.py` - класс для объектов стикеров и класс для рисования аннотаций для полей PDF файла.


### Описание основных функций

Сигнатура функции создания стикеров MCScap

```python
def mcscap_create_pdf_dxf(
        path_to_input_txt: str,     # входной файл (в формате txt)
        sign: Sign                  # флаг обозначающий символ на стикере (либо lot, либо sn)
):
    ...
```

Функция `create_pdf_dxf(...)` используется для генерации PDF и DXF, и может быть использована для печати других стикеров. 
Сигнатура основной функции создания PDF и DXF файла

```python
def create_pdf_dxf(
        stickers: list[Sticker],    # список с объектами класса Sticker
        dx: int, dy: int,           # смещения по оси x, y для стикеров
        dir_to_save: str,           # директория сохранения DXF и PDF файла
        x_pad: int, y_pad: int,     # отступы на странице
        dx_inner=0.49, dy_inner=0.52,   # внутренние отступы для создания контура в DXF файле   
        annotation: str = "TASK_0001"   # аннотирование страниц PDF файла
):
    ...
```

### Используемые библиотеки

Для создания PDF и отрисовки стикеров используется библиотека `reportlab`.
Библиотека `reportlab` не может напрямую отрисовывать изображения в формате SVG.
Для этого изображения SVG преобразовываются в RLG с помощью библиотеки `svglib`.
Во время использования библиотека наблюдались дефекты изображения, которые были испрвлены путём создания копии
библиотеки `svglib`(`_svglib`).

Для создания DXF файла для резки наклеек используется библиотека `ezdxf`.